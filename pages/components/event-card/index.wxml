<!--pages/components/event-card/index.wxml-->
<wxs src="../../../utils/time-tools.wxs" module="timeTools" />

<view class="event-card {{hovered ? 'event-card_hovered' : ''}}" bindlongtap="hoverCard" bindtouchend="unHoverCard">
  <view class="event-card_user" bindtap="toDetail">
    <image lazy-load="{{true}}" class="avatar" src="{{ event.user.avatar_url || '/static/default_avatar.jpg' }}"></image>
    <view class="event-card_ground-info">
      <view class="event-card_info1">
        <text>{{event.user.nickname}}</text>
        <!-- <text>等级1</text> -->
      </view>
      <view class="event-card_info2 text-overflow">
        <text>{{timeTools.formatTime(event.create_time)}}</text>
        <text>{{event.location_name ? '来自' : ''}}</text>
        <text>{{event.location_name}}</text>
      </view>
    </view>
    <view class="event-card_btn">
      <follow-btn wx:if="{{event.user.id != user.id}}" userId="{{event.user.id}}" text="{{!event.user.follow ? '关注' : '已关注'}}" disabled="{{event.user.follow}}" bindfollowstatus="setFollow"></follow-btn>
      {{userInfo.id}}
    </view>
  </view>
  <view class="event-card_content" bindtap="toDetail">
    {{event.content}}
    <view class="image-box" style="width: {{ event.images.length == 1 ? '60%'  : '100%'}};">
      <image style="height: {{ event.images.length > 1 ? 90 / event.images.length : 40}}vw;" wx:for="{{event.images}}" binderror="imgLoadError" data-index="{{index}}" wx:key="{{index}}" wx:for-item="img" lazy-load="{{true}}" mode="aspectFill" src="{{ img }}" catchtap="preview"></image>
    </view>
  </view>
  <view class="event-card-footer">
    <view class="topic-title text-overflow" catchtap="goSubjectDetail">
      <image class="topic-icon" src="/static/icon_huati@2x.png"></image>
      #{{event.subject.title}}
    </view>
    <view class="footer-operations">
      <!-- <view class="operation">
        <image class="operation-icon" wx:if="{{event.praise}}" src="/static/flower.png"></image>
        <image class="operation-icon" wx:else src="/static/normal_flower.png"></image>
        {{event.participant_num}}
      </view> -->
      <view class="operation" catchtap="shareEvent" catchtap="shareEvent">
        <image class="operation-icon" src="/static/normal_share.png"></image>
        {{event.share_num}}
      </view>
      <view class="operation" catchtap="toDetail">
        <image class="operation-icon" src="/static/normal_comment.png"></image>
        {{event.comment_num}}
      </view>
      <view class="operation" catchtap="setPraise">
        <image class="operation-icon like-icon" wx:if="{{event.praise}}" src="/static/red_like.png"></image>
        <image class="operation-icon unlike-icon" wx:else src="/static/normal_like.png"></image>
        {{event.praise_num}}
      </view> 
    </view>
  </view>
</view>

<view class="cu-modal {{shareEventShow ? 'show' : ''}}" bindtap="hideEvent">
  <view class="share-paper-card" style="width: 570rpx;height:665rpx;" catchtap="previewImg">
    <image style="width: 570rpx;height:600rpx;" src="{{sharePaperPath}}" class="share-img"></image>
    <view class="share-button">
      <view class="btn" catchtap="saveImage">一键保存</view>
    </view>
  </view>
</view>

<canvas class="share-canvas" style="width: 570rpx;height:600rpx;" canvas-id="myeventcanvas"/>
